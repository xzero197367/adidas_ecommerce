@model Adidas.DTOs.Main.Product_DTOs.ProductDto

@{
    ViewData["Title"] = $"Product Details - {Model.Name}";
    // Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">
            <i class="fas fa-box me-2"></i>@Model.Name
        </h2>
        <div class="btn-group">
            <a asp-action="Edit" asp-controller="Product1" asp-route-id="@Model.Id" class="btn btn-primary">
                <i class="fas fa-edit me-2"></i>Edit Product
            </a>
            <a asp-action="Index" asp-controller="Product1" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i>Back to Products
            </a>
        </div>
    </div>

    <div class="row">
        <!-- Product Information -->
        <div class="col-lg-8">
            <!-- Basic Info -->
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-info-circle me-2"></i>Product Information
                    </h5>
                    <div>
                        @if (Model.IsOnSale)
                        {
                            <span class="badge bg-danger me-2">ON SALE</span>
                        }
                        @if (Model.IsActive)
                        {
                            <span class="badge bg-success">Active</span>
                        }
                        else
                        {
                            <span class="badge bg-secondary">Inactive</span>
                        }
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                <tr>
                                    <th width="120">Name:</th>
                                    <td>@Model.Name</td>
                                </tr>
                                <tr>
                                    <th>SKU:</th>
                                    <td><code>@Model.Sku</code></td>
                                </tr>
                                <tr>
                                    <th>Category:</th>
                                    <td>@Model.CategoryName</td>
                                </tr>
                                <tr>
                                    <th>Brand:</th>
                                    <td>@Model.BrandName</td>
                                </tr>
                                <tr>
                                    <th>Gender:</th>
                                    <td>@Model.GenderTarget</td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                <tr>
                                    <th width="120">Price:</th>
                                    <td>
                                        @if (Model.IsOnSale)
                                        {
                                            <span class="text-danger fw-bold fs-5">$@Model.SalePrice?.ToString("F2")</span>
                                            <br>
                                            <small class="text-decoration-line-through text-muted">$@Model.Price.ToString("F2")</small>
                                        }
                                        else
                                        {
                                            <span class="fw-bold fs-5">$@Model.Price.ToString("F2")</span>
                                        }
                                    </td>
                                </tr>
                                <tr>
                                    <th>Stock Status:</th>
                                    <td>
                                        @if (Model.ComputedInStock)
                                        {
                                            <span class="badge bg-success">In Stock</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-danger">Out of Stock</span>
                                        }
                                    </td>
                                </tr>
                                <tr>
                                    <th>Reviews:</th>
                                    <td>
                                        @if (Model.ReviewCount > 0)
                                        {
                                            <div class="d-flex align-items-center">
                                                <div class="me-2">
                                                    @for (int i = 1; i <= 5; i++)
                                                    {
                                                        if (i <= Model.AverageRating)
                                                        {
                                                            <i class="fas fa-star text-warning"></i>
                                                        }
                                                        else
                                                        {
                                                            <i class="far fa-star text-muted"></i>
                                                        }
                                                    }
                                                </div>
                                                <span class="text-muted">(@Model.ReviewCount reviews)</span>
                                            </div>
                                        }
                                        else
                                        {
                                            <span class="text-muted">No reviews yet</span>
                                        }
                                    </td>
                                </tr>
                                <tr>
                                    <th>Created:</th>
                                    <td>@Model.CreatedAt.ToString("MMM dd, yyyy")</td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <div class="mt-3">
                        <h6>Description:</h6>
                        <p class="text-muted">@Model.Description</p>
                    </div>
                </div>
            </div>

            <!-- Product Images -->
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-images me-2"></i>Product Images
                    </h5>
                    <a asp-action="ManageImages" asp-controller="Product1" asp-route-id="@Model.Id" class="btn btn-sm btn-primary">
                        <i class="fas fa-plus me-1"></i>Manage Images
                    </a>
                </div>
                <div class="card-body">
                    @if (Model.Images?.Any() == true)
                    {
                        <div class="row g-3">
                            @foreach (var image in Model.Images.Take(6))
                            {
                                <div class="col-md-4 col-sm-6">
                                    <div class="position-relative">
                                        <img src="@image.ImageUrl" alt="@image.AltText"
                                             class="img-fluid rounded shadow-sm" style="height: 200px; object-fit: cover; width: 100%;">
                                        @if (image.IsPrimary)
                                        {
                                            <span class="position-absolute top-0 start-0 m-2 badge bg-primary">Primary</span>
                                        }
                                    </div>
                                </div>
                            }
                            @if (Model.Images.Count() > 6)
                            {
                                <div class="col-md-4 col-sm-6">
                                    <div class="d-flex align-items-center justify-content-center border rounded"
                                         style="height: 200px; background-color: #f8f9fa;">
                                        <div class="text-center">
                                            <i class="fas fa-plus fa-2x text-muted mb-2"></i>
                                            <p class="text-muted mb-0">+@(Model.Images.Count() - 6) more</p>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-4">
                            <i class="fas fa-image fa-3x text-muted mb-3"></i>
                            <p class="text-muted">No images uploaded</p>
                            <a asp-action="ManageImages" asp-controller="Product1" asp-route-id="@Model.Id" class="btn btn-outline-primary">
                                <i class="fas fa-plus me-2"></i>Add Images
                            </a>
                        </div>
                    }
                </div>
            </div>

            <!-- Product Variants -->
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-layer-group me-2"></i>Product Variants
                    </h5>
                    <a asp-controller="ProductVariant1" asp-action="Create" asp-route-productId="@Model.Id"
                       class="btn btn-sm btn-primary">
                        <i class="fas fa-plus me-1"></i>Add Variant
                    </a>
                </div>
                <div class="card-body">
                    @if (Model.Variants?.Any() == true)
                    {
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>SKU</th>
                                        <th>Color</th>
                                        <th>Size</th>
                                        <th>Stock</th>
                                        <th>Price Adj.</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var variant in Model.Variants)
                                    {
                                        <tr>
                                            <td><code>@variant.Sku</code></td>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    @if (!string.IsNullOrEmpty(variant.ColorHex))
                                                    {
                                                        <div class="me-2 rounded-circle border"
                                                             style="width: 20px; height: 20px; background-color: @variant.ColorHex;"></div>
                                                    }
                                                    @variant.Color
                                                </div>
                                            </td>
                                            <td>@variant.Size</td>
                                            <td>
                                                @if (variant.StockQuantity > 0)
                                                {
                                                    <span class="badge bg-success">@variant.StockQuantity</span>
                                                }
                                                else
                                                {
                                                    <span class="badge bg-danger">Out of Stock</span>
                                                }
                                            </td>
                                            <td>
                                                @if (variant.PriceAdjustment != 0)
                                                {
                                                    <span class="@(variant.PriceAdjustment > 0 ? "text-success" : "text-danger")">
                                                        @variant.PriceAdjustment.ToString("+0.00;-0.00;0")
                                                    </span>
                                                }
                                                else
                                                {
                                                    <span class="text-muted">-</span>
                                                }
                                            </td>
                                            <td>
                                                @if (variant.IsActive)
                                                {
                                                    <span class="badge bg-success">Active</span>
                                                }
                                                else
                                                {
                                                    <span class="badge bg-secondary">Inactive</span>
                                                }
                                            </td>
                                            <td>
                                                <div class="btn-group btn-group-sm">
                                                    <a asp-controller="ProductVariant1" asp-action="Details" asp-route-id="@variant.Id"
                                                       class="btn btn-outline-info" title="View">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                    <a asp-controller="ProductVariant1" asp-action="Edit" asp-route-id="@variant.Id"
                                                       class="btn btn-outline-primary" title="Edit">
                                                        <i class="fas fa-edit"></i>
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-4">
                            <i class="fas fa-layer-group fa-3x text-muted mb-3"></i>
                            <p class="text-muted">No variants created</p>
                            <a asp-controller="ProductVariant1" asp-action="Create" asp-route-productId="@Model.Id"
                               class="btn btn-outline-primary">
                                <i class="fas fa-plus me-2"></i>Create First Variant
                            </a>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Quick Actions -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-bolt me-2"></i>Quick Actions
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a asp-action="Edit" asp-controller="Product1" asp-route-id="@Model.Id" class="btn btn-primary">
                            <i class="fas fa-edit me-2"></i>Edit Product
                        </a>
                        <a asp-action="ManageVariants" asp-controller="Product1" asp-route-id="@Model.Id" class="btn btn-outline-warning">
                            <i class="fas fa-layer-group me-2"></i>Manage Variants
                        </a>
                        <a asp-action="ManageImages" asp-controller="Product1" asp-route-id="@Model.Id" class="btn btn-outline-info">
                            <i class="fas fa-images me-2"></i>Manage Images
                        </a>
                        <a asp-action="ManageAttributes" asp-controller="Product1" asp-route-id="@Model.Id" class="btn btn-outline-secondary">
                            <i class="fas fa-tags me-2"></i>Manage Attributes
                        </a>
                        <button class="btn btn-outline-danger" onclick="toggleProductStatus('@Model.Id', @Model.IsActive.ToString().ToLower())">
                            <i class="fas fa-toggle-@(Model.IsActive ? "off" : "on") me-2"></i>
                            @(Model.IsActive ? "Deactivate" : "Activate")
                        </button>
                    </div>
                </div>
            </div>

            <!-- SEO Information -->
            @if (!string.IsNullOrEmpty(Model.MetaTitle) || !string.IsNullOrEmpty(Model.MetaDescription))
            {
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-search me-2"></i>SEO Information
                        </h5>
                    </div>
                    <div class="card-body">
                        @if (!string.IsNullOrEmpty(Model.MetaTitle))
                        {
                            <div class="mb-3">
                                <strong>Meta Title:</strong>
                                <p class="text-muted mb-0">@Model.MetaTitle</p>
                            </div>
                        }
                        @if (!string.IsNullOrEmpty(Model.MetaDescription))
                        {
                            <div>
                                <strong>Meta Description:</strong>
                                <p class="text-muted mb-0">@Model.MetaDescription</p>
                            </div>
                        }
                    </div>
                </div>
            }

            <!-- Statistics -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-line me-2"></i>Statistics
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-6 border-end">
                            <h4 class="text-primary mb-0">@(Model.Variants?.Count() ?? 0)</h4>
                            <small class="text-muted">Variants</small>
                        </div>
                        <div class="col-6">
                            <h4 class="text-success mb-0">@(Model.Variants?.Sum(v => v.StockQuantity) ?? 0)</h4>
                            <small class="text-muted">Total Stock</small>
                        </div>
                    </div>
                    <hr>
                    <div class="row text-center">
                        <div class="col-6 border-end">
                            <h4 class="text-warning mb-0">@Model.ReviewCount</h4>
                            <small class="text-muted">Reviews</small>
                        </div>
                        <div class="col-6">
                            <h4 class="text-info mb-0">@Model.AverageRating.ToString("F1")</h4>
                            <small class="text-muted">Rating</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Reviews -->
            @if (Model.Reviews?.Any() == true)
            {
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-star me-2"></i>Recent Reviews
                        </h5>
                    </div>
                    <div class="card-body">
                        @foreach (var review in Model.Reviews.OrderByDescending(r => r.CreatedAt).Take(3))
                        {
                            <div class="mb-3 @(Model.Reviews.Last() != review ? "border-bottom pb-3" : "")">
                                <div class="d-flex justify-content-between align-items-start mb-1">
                                    <div>
                                        @for (int i = 1; i <= 5; i++)
                                        {
                                            if (i <= review.Rating)
                                            {
                                                <i class="fas fa-star text-warning"></i>
                                            }
                                            else
                                            {
                                                <i class="far fa-star text-muted"></i>
                                            }
                                        }
                                    </div>
                                    <small class="text-muted">@review.CreatedAt.Equals("MMM dd, yyyy")</small>
                                </div>
                                @if (!string.IsNullOrEmpty(review.Title))
                                {
                                    <strong class="d-block">@review.Title</strong>
                                }
                                @if (!string.IsNullOrEmpty(review.ReviewText))
                                {
                                    <p class="text-muted small mb-0">
                                        @(review.ReviewText.Length > 100 ? review.ReviewText.Substring(0, 100) + "..." : review.ReviewText)
                                    </p>
                                }
                            </div>
                        }
                        @if (Model.Reviews.Count() > 3)
                        {
                            <div class="text-center">
                                <a href="#" class="btn btn-sm btn-outline-primary">View All Reviews</a>
                            </div>
                        }
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function toggleProductStatus(productId, currentStatus) {
            const action = currentStatus ? 'deactivate' : 'activate';

            if (confirm(`Are you sure you want to ${action} this product?`)) {
                fetch(`/Admin/Product/ToggleStatus/${productId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert('Error: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while updating the product status.');
                });
            }
        }
    </script>
}